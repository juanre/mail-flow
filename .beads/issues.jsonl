{"id":"mailflow-0lp","title":"Make ui.py select_workflow() async","description":"Convert WorkflowSelector.select_workflow() to async. It calls classify_with_archivist() and record_feedback() which are async. Note: input() is blocking but that's fine - we await the async classifier calls around it.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-30T18:36:59.126929Z","updated_at":"2025-12-30T19:00:17.994809Z","closed_at":"2025-12-30T19:00:17.994809Z","close_reason":"Completed async refactoring chain. All modules now async with single asyncio.run() at CLI entry points. 235 tests passing.","dependencies":[{"issue_id":"mailflow-0lp","depends_on_id":"mailflow-h5w","type":"discovered-from","created_at":"2025-12-30T18:36:59.127766Z","created_by":"juanre"}]}
{"id":"mailflow-14h","title":"Focused training mode for specific workflows","description":"Add ability to train on emails filtered by date range and workflow set, with minimum confidence gate. Enables efficient focused training sessions.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-30T21:45:38.069429Z","updated_at":"2025-12-30T21:56:14.719931Z","closed_at":"2025-12-30T21:56:14.719931Z","close_reason":"All subtasks complete - focused training mode implemented"}
{"id":"mailflow-1sb","title":"Fix failing test_path_traversal_simple_dotdot test","description":"Pre-existing test failure in tests/test_security.py::TestPathValidation::test_path_traversal_simple_dotdot. The test expects PathSecurityError to be raised but it doesn't. This is unrelated to the async refactoring work.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-30T18:37:25.737036Z","updated_at":"2025-12-30T19:33:55.881059Z","closed_at":"2025-12-30T19:33:55.881059Z","close_reason":"Fixed flaky test - made it deterministic by using temp directory as allowed base"}
{"id":"mailflow-2rv","title":"Add --min-confidence gate for focused training","description":"Add --min-confidence option (default 0.0). Run classification before showing to user. Skip emails where best match confidence \u003c threshold. Default 0.45 when --workflows is specified.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-30T21:45:50.518586Z","updated_at":"2025-12-30T21:56:14.494011Z","closed_at":"2025-12-30T21:56:14.494011Z","close_reason":"Implemented --min-confidence gate (default 0.45 when --workflows set)"}
{"id":"mailflow-2tx","title":"Make archivist_client.py expose async API directly","description":"Remove sync wrappers from archivist_client.py. Expose classify_async(), feedback_async(), get_metrics_async() directly. The current approach of calling asyncio.run() per-call breaks connection pooling because each call creates/destroys an event loop, invalidating the cached connection pool.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-30T18:36:46.242147Z","updated_at":"2025-12-30T19:00:09.245243Z","closed_at":"2025-12-30T19:00:09.245243Z","close_reason":"Made archivist_client.py expose async API directly. All functions (classify, feedback, get_metrics) are now async. Tests passing."}
{"id":"mailflow-4fg","title":"Send full email context to LLM classification","description":"","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-31T10:10:34.428036Z","updated_at":"2025-12-31T10:21:47.904551Z","closed_at":"2025-12-31T10:21:47.904551Z","close_reason":"Implemented full email context for LLM: validation, no truncation, PDF attachment names, HTMLâ†’PDF rendering via llmring"}
{"id":"mailflow-8ei","title":"Update tests for async refactoring","description":"Update tests that call process(), select_workflow(), or archivist functions to be async. pytest-asyncio is already configured (asyncio_mode = auto). Tests need to use async def and await the async functions.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-30T18:37:18.544966Z","updated_at":"2025-12-30T19:00:17.99548Z","closed_at":"2025-12-30T19:00:17.99548Z","close_reason":"Completed async refactoring chain. All modules now async with single asyncio.run() at CLI entry points. 235 tests passing.","dependencies":[{"issue_id":"mailflow-8ei","depends_on_id":"mailflow-oc7","type":"discovered-from","created_at":"2025-12-30T18:37:18.545778Z","created_by":"juanre"}]}
{"id":"mailflow-9oi","title":"Make process.py process() async","description":"Convert process() function to async. It calls ui.select_workflow() which is async. This is the main processing function that orchestrates email classification and workflow execution.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-30T18:37:04.737914Z","updated_at":"2025-12-30T19:00:17.995046Z","closed_at":"2025-12-30T19:00:17.995046Z","close_reason":"Completed async refactoring chain. All modules now async with single asyncio.run() at CLI entry points. 235 tests passing.","dependencies":[{"issue_id":"mailflow-9oi","depends_on_id":"mailflow-0lp","type":"discovered-from","created_at":"2025-12-30T18:37:04.73878Z","created_by":"juanre"}]}
{"id":"mailflow-c9i","title":"Sort emails by date descending (most recent first)","description":"Always sort emails by Date header descending (most recent first) in batch processing. Keep email_files, email_contents, email_data_list in sync during sort. This is the default behavior, not optional.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-30T21:45:50.279973Z","updated_at":"2025-12-30T21:50:13.264046Z","closed_at":"2025-12-30T21:50:13.264046Z","close_reason":"Implemented date sorting - emails now processed most recent first"}
{"id":"mailflow-h5w","title":"Make archivist_integration.py async","description":"Convert classify_with_archivist() and record_feedback() to async functions. These call archivist_client which needs to be async for proper connection pool management.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-30T18:36:52.371522Z","updated_at":"2025-12-30T19:00:17.994283Z","closed_at":"2025-12-30T19:00:17.994283Z","close_reason":"Completed async refactoring chain. All modules now async with single asyncio.run() at CLI entry points. 235 tests passing.","dependencies":[{"issue_id":"mailflow-h5w","depends_on_id":"mailflow-2tx","type":"discovered-from","created_at":"2025-12-30T18:36:52.372926Z","created_by":"juanre"}]}
{"id":"mailflow-lss","title":"Add --workflows filter to batch/fetch files","description":"Add --workflows/-w option accepting comma-separated workflow names. Pass filtered workflow list to classifier. Only show these workflows as options.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-30T21:45:49.815871Z","updated_at":"2025-12-30T21:56:14.278733Z","closed_at":"2025-12-30T21:56:14.278733Z","close_reason":"Implemented --workflows filter option"}
{"id":"mailflow-oc7","title":"Update CLI entry points to use asyncio.run() once at top level","description":"Refactor CLI commands (batch, gmail, archivist-metrics, single email processing) to use a single asyncio.run() at the entry point. This keeps the event loop alive for the entire operation, allowing the connection pool to be reused properly. Pattern: sync CLI function calls asyncio.run(async_impl(...)).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-30T18:37:12.086351Z","updated_at":"2025-12-30T19:00:17.995274Z","closed_at":"2025-12-30T19:00:17.995274Z","close_reason":"Completed async refactoring chain. All modules now async with single asyncio.run() at CLI entry points. 235 tests passing.","dependencies":[{"issue_id":"mailflow-oc7","depends_on_id":"mailflow-9oi","type":"discovered-from","created_at":"2025-12-30T18:37:12.087193Z","created_by":"juanre"}]}
{"id":"mailflow-pf6","title":"Add date range filtering (--after, --before)","description":"Add --after and --before options (YYYY-MM-DD format) to batch/fetch files. Parse email Date headers during pre-extraction. Filter emails outside the range. Works independently of --workflows.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-30T21:45:50.048194Z","updated_at":"2025-12-30T21:52:20.4306Z","closed_at":"2025-12-30T21:52:20.4306Z","close_reason":"Implemented --after and --before date filtering options"}
